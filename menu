#!/bin/bash
# SSLABLk Multi Service Menu v2
clear
echo "============================================" | lolcat 2>/dev/null || echo "============================================"
echo "         SSLABLk VPS MANAGER v2.0"            | lolcat 2>/dev/null || echo "         SSLABLk VPS MANAGER v2.0"
echo "============================================" | lolcat 2>/dev/null || echo "============================================"
echo ""
echo "1.  Create SSH WebSocket"
echo "2.  Create Trojan WebSocket"
echo "3.  Create UDP User"
echo "4.  Delete UDP User"
echo "5.  List UDP Users"
echo "6.  Check Active UDP Sessions"
echo "7.  Restart All Services"
echo "8.  Change Ports (UDP/WS)"
echo "9.  VPS Speedtest"
echo "10. Backup / Restore Users"
echo "11. System Info"
echo "12. Exit"
echo ""
read -p "Select menu [1-12]: " opt

# Path data
UDPDIR="/root/udp"
USERFILE="$UDPDIR/users.txt"
EXPIRE_FILE="/etc/expire_users.txt"

mkdir -p $UDPDIR

case $opt in
1)
    clear
    echo "============================================"
    echo "üöÄ Create SSH WebSocket Account"
    echo "============================================"
    read -p "Username : " user
    read -p "Password : " pass
    read -p "Active days : " days
    useradd -e $(date -d "$days days" +"%Y-%m-%d") -m -s /bin/bash $user >/dev/null 2>&1
    echo "$user:$pass" | chpasswd
    expire_date=$(date -d "$days days" +"%Y-%m-%d")
    echo "$user $expire_date" >> $EXPIRE_FILE
    echo "--------------------------------------------"
    echo "‚úÖ SSH WebSocket Account Created"
    echo "User     : $user"
    echo "Password : $pass"
    echo "Expires  : $expire_date"
    echo "Host     : $(hostname -I | awk '{print $1}')"
    echo "Port     : 80 / 443 (TLS)"
    echo "Path     : /ssh"
    echo "--------------------------------------------"
    ;;
2)
    clear
    echo "============================================"
    echo "‚ö° Create Trojan WS Account"
    echo "============================================"
    read -p "Username : " user
    read -p "Active days : " days
    UUID=$(cat /proc/sys/kernel/random/uuid)
    expire_date=$(date -d "$days days" +"%Y-%m-%d")
    echo "$user $UUID $expire_date" >> /etc/trojan_users.txt
    echo "--------------------------------------------"
    echo "‚úÖ Trojan WS Account Created"
    echo "User     : $user"
    echo "Password : $UUID"
    echo "Expires  : $expire_date"
    echo "Host     : $(hostname -I | awk '{print $1}')"
    echo "Port     : 443 (TLS)"
    echo "Path     : /trojan"
    echo "--------------------------------------------"
    ;;
3)
    clear
    echo "============================================"
    echo "‚ûï Create UDP User"
    echo "============================================"
    read -p "Username : " user
    read -p "Password : " pass
    read -p "Active days : " days
    expire_date=$(date -d "$days days" +"%Y-%m-%d")
    echo "$user:$pass:$expire_date" >> $USERFILE
    echo "$user $expire_date" >> $EXPIRE_FILE
    echo "--------------------------------------------"
    echo "‚úÖ UDP User Added"
    echo "User     : $user"
    echo "Password : $pass"
    echo "Expires  : $expire_date"
    echo "--------------------------------------------"
    ;;
4)
    clear
    echo "============================================"
    echo "‚ùå Delete UDP User"
    echo "============================================"
    read -p "Username : " user
    sed -i "/^$user:/d" $USERFILE
    sed -i "/^$user /d" $EXPIRE_FILE
    echo "User $user deleted successfully."
    ;;
5)
    clear
    echo "============================================"
    echo "üìú UDP User List"
    echo "============================================"
    if [ -f $USERFILE ]; then
        column -t -s ":" $USERFILE
    else
        echo "No users found."
    fi
    ;;
6)
    clear
    echo "============================================"
    echo "üß† Active UDP Sessions"
    echo "============================================"
    netstat -anu | grep udp || echo "No active UDP sessions."
    ;;
7)
    clear
    echo "============================================"
    echo "üîÅ Restarting Services"
    echo "============================================"
    systemctl restart udp-custom 2>/dev/null
    systemctl restart xray 2>/dev/null
    systemctl restart nginx 2>/dev/null
    echo "All services restarted successfully."
    ;;
8)
    clear
    echo "============================================"
    echo "‚öôÔ∏è Change Ports"
    echo "============================================"
    echo "Feature coming soon..."
    ;;
9)
    clear
    echo "============================================"
    echo "üöÄ VPS Speedtest"
    echo "============================================"
    apt install -y speedtest-cli >/dev/null 2>&1
    speedtest
    ;;
10)
    clear
    echo "============================================"
    echo "üíæ Backup & Restore"
    echo "============================================"
    echo "Feature coming soon..."
    ;;
11)
    clear
    echo "============================================"
    echo "üñ•Ô∏è System Info"
    echo "============================================"
    neofetch || hostnamectl
    ;;
12)
    echo "Exiting menu..."
    exit
    ;;
*)
    echo "Invalid selection!"
    ;;
esac
